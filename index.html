<!DOCTYPE HTML>
<html>

<head>
    <title>Skillbot Analysis</title>
    <meta charset="UTF-8">
    <style>
        * {
            padding: 0;
            margin: 0;
        }

        .content {
            display: flex;
            justify-content: space-around;
            align-items: center;
            background: #030303;
            height: 10vh;
        }

        .value {
            font-size: 50px;
            display: block;
            font-weight: bold;
            color: #fff;
        }
    </style>

    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.min.css">
    <!-- <script src="https://unpkg.com/axios/dist/axios.min.js"></script> -->
    <script>
        var chart = null;
        var dataPoints1 = [];

        window.onload = function () {


            const counters = document.querySelectorAll('.value');
            const speed = 500;

            counters.forEach(counter => {
                const animate = () => {
                    const value = +counter.getAttribute('akhi');
                    const data = +counter.innerText;

                    const time = value / speed;
                    if (data < value) {
                        counter.innerText = Math.ceil(data + time);
                        setTimeout(animate, 1);
                    } else {
                        counter.innerText = value;
                    }

                }

                animate();
            });




            //Daily User vs Unique Users of the bot
            var chartVisitor = new CanvasJS.Chart("visitor", {
                animationEnabled: true,
                theme: "light2",
                title: {
                    text: "Chabot Users Information"
                },
                axisX: {
                    valueFormatString: "DD MMM",
                    crosshair: {
                        enabled: true,
                        snapToDataPoint: true
                    }
                },
                axisY: {
                    title: "Number of Visits",
                    crosshair: {
                        enabled: true
                    }
                },
                toolTip: {
                    shared: true
                },
                legend: {
                    cursor: "pointer",
                    verticalAlign: "bottom",
                    horizontalAlign: "left",
                    dockInsidePlotArea: true,
                    itemclick: toogleDataSeries
                },
                data: [{
                    type: "line",
                    showInLegend: true,
                    name: "Total Visit",
                    markerType: "square",
                    xValueFormatString: "DD MMM, YYYY",
                    color: "#F08080",
                    dataPoints: [
                        { x: new Date(2021, 7, 3), y: 650 },
                        { x: new Date(2021, 7, 4), y: 700 },
                        { x: new Date(2021, 7, 5), y: 710 },
                        { x: new Date(2021, 7, 6), y: 658 },
                        { x: new Date(2021, 7, 7), y: 734 },
                        { x: new Date(2021, 7, 8), y: 963 },
                        { x: new Date(2021, 7, 9), y: 847 },
                        { x: new Date(2021, 7, 10), y: 853 },
                        { x: new Date(2021, 7, 11), y: 869 },
                        { x: new Date(2021, 7, 12), y: 943 },
                        { x: new Date(2021, 7, 13), y: 970 },
                        { x: new Date(2021, 7, 14), y: 869 },
                        { x: new Date(2021, 7, 15), y: 890 },
                        { x: new Date(2021, 7, 16), y: 930 }
                    ]
                },
                {
                    type: "line",
                    showInLegend: true,
                    name: "Unique Visit",
                    lineDashType: "dash",
                    dataPoints: [
                        { x: new Date(2021, 7, 3), y: 510 },
                        { x: new Date(2021, 7, 4), y: 560 },
                        { x: new Date(2021, 7, 5), y: 540 },
                        { x: new Date(2021, 7, 6), y: 558 },
                        { x: new Date(2021, 7, 7), y: 544 },
                        { x: new Date(2021, 7, 8), y: 693 },
                        { x: new Date(2021, 7, 9), y: 657 },
                        { x: new Date(2021, 7, 10), y: 663 },
                        { x: new Date(2021, 7, 11), y: 639 },
                        { x: new Date(2021, 7, 12), y: 673 },
                        { x: new Date(2021, 7, 13), y: 660 },
                        { x: new Date(2021, 7, 14), y: 562 },
                        { x: new Date(2021, 7, 15), y: 643 },
                        { x: new Date(2021, 7, 16), y: 570 }
                    ]
                }]
            });
            chartVisitor.render();

            function toogleDataSeries(e) {
                if (typeof (e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
                    e.dataSeries.visible = false;
                } else {
                    e.dataSeries.visible = true;
                }
                chartVisitor.render();
            }



            //Daily Visitor using api of the bot
            chart = new CanvasJS.Chart("chartContainer", {
                animationEnabled: true,
                theme: "light2",
                title: {
                    text: "Daily Visitor Data By using API"
                },
                axisY: {
                    title: "Users",
                    titleFontSize: 24
                },
                data: [{
                    type: "column",
                    yValueFormatString: "#,### Users",
                    dataPoints: dataPoints1
                }]
            });


            $.getJSON("https://canvasjs.com/data/gallery/javascript/daily-sales.json?callback=?", callback);


            //Success Rate of the bot
            var successChart = new CanvasJS.Chart("chartSuccess", {
                animationEnabled: true,
                title: {
                    text: "Success Rate of the bot",
                    horizontalAlign: "left"
                },
                data: [{
                    type: "pie",
                    startAngle: 60,
                    //innerRadius: 60,
                    indexLabelFontSize: 17,
                    indexLabel: "{label} - #percent%",
                    toolTipContent: "<b>{label}:</b> {y} (#percent%)",
                    dataPoints: [
                        { y: 1800, label: "Successful Message" },
                        { y: 250, label: "Unidentified Message" }
                    ]
                }]
            });
            successChart.render();

            $(document).ready(function () {
                $('#example').DataTable({
                    responsive: true
                });
            });
            
            // GET Request.
            // fetch('https://mongo-analytics-api.herokuapp.com/analytics/conv-count', {
            //         method: 'GET', // or 'PUT'
            //         headers: {
            //             'Content-Type': 'application/json',
            //             'Access-Control-Allow-Origin': '*',
            //             'Access-Control-Allow-Credentials' : true
            //         }
            //     })
            //     .then(response => response.json())  // convert to json
            //     .then(json => console.log(json))    //print data to console
            //     .catch(err => console.log('Request Failed', err)); // Catch errors
            // const headers = {
            //             'Content-Type': 'application/json',
            //             'Access-Control-Allow-Origin': '*',
            //             'Access-Control-Allow-Credentials' : true
            //         };
            fetch("https://mongo-analytics-api.herokuapp.com/analytics/conv-count", {
                    mode: 'cors',
                    credentials: 'include',
                    method: 'GET',
                    "Access-Control-Allow-Origin": '*' 
                    // headers: headers
                })
                .then(response => response.json())
                .then(json => console.log(json))
                .catch(error => console.log('Authorization failed : ' + error.message));
            

        //     $.ajax({
        //     headers: { "Accept": "application/json"},
        //     type: 'GET',
        //     url: 'https://mongo-analytics-api.herokuapp.com/analytics/totalusers',
        //     crossDomain: true,
        //     beforeSend: function(xhr){
        //         xhr.withCredentials = true;
        //   },
        //     success: function(data, textStatus, request){
        //         console.log(data);
        //     }
        // });
       

        }
        function callback(data) {
            for (var i = 0; i < data.dps.length; i++) {
                console.log(data.dps[i])
                dataPoints1.push({
                    x: new Date(data.dps[i].date),
                    y: data.dps[i].units
                });
            }
            chart.render();
        }




    </script>
</head>

<body>
    <div class="content">
        <div style="color:#fff; font-size: 50px; text-align: center;">Total Users</div>
        <div style="color:#fff; font-size: 50px; text-align: center">Total Conversations</div>
    </div>
    <div class="content">
        <div class="value" akhi="1000">0</div>
        <div class="value" akhi="50000">0</div>
    </div>
    <br><br>
    <div id="visitor" style="height: 370px; max-width: 920px; margin: 0px auto;"></div>
    <br><br>
    <div id="chartContainer" style="height: 370px; max-width: 920px; margin: 0px auto;"></div>
    <br><br>
    <div id="chartSuccess" style="height: 370px; max-width: 920px; margin: 0px auto;"></div>
    <br> <br>
    <div
        style="background-color:#eee; text-align: center; width:60%;  margin-left: 25%; margin-top: 10px; margin-bottom: 125px;">
        <table id="example" class="table table-striped table-bordered">
            <caption>Top most frequently used intent</caption>

                    <thead>
                            <tr>
                                    <th>Intent Name</th>
                                    <th>Last Session</th>
                            </tr>
                    </thead>
                    <tbody>
                       <tr>
                               <td>Hi</td>
                               <td>13-08-2021</td>  
                       </tr>
                <tr>
                               <td>Try</td>
                               <td>14-08-2021</td>  
                       </tr>
                <tr>
                               <td>Test</td>
                               <td>15-08-2021</td>  
                       </tr>
                <tr>
                               <td>Hllo</td>
                               <td>16-08-2021</td>  
                       </tr>
                <tr>
                               <td>llo</td>
                               <td>17-08-2021</td>  
                       </tr>
                <tr>
                               <td>Hi</td>
                               <td>13-08-2021</td>  
                       </tr>
                <tr>
                               <td>Try</td>
                               <td>14-08-2021</td>  
                       </tr>
                <tr>
                               <td>Test</td>
                               <td>15-08-2021</td>  
                       </tr>
                <tr>
                               <td>Hllo</td>
                               <td>16-08-2021</td>  
                       </tr>
                <tr>
                               <td>llo</td>
                               <td>17-08-2021</td>  
                       </tr>
                <tr>
                               <td>Hi</td>
                               <td>13-08-2021</td>  
                       </tr>
                <tr>
                               <td>Try</td>
                               <td>14-08-2021</td>  
                       </tr>
                <tr>
                               <td>Test</td>
                               <td>15-08-2021</td>  
                       </tr>
                <tr>
                               <td>Hllo</td>
                               <td>16-08-2021</td>  
                       </tr>
                <tr>
                               <td>llo</td>
                               <td>17-08-2021</td>  
                       </tr>
            </tbody>
                
        </table>
    </div>


    <script src="./canvasjs.min.js"></script>
    <script src="https://canvasjs.com/assets/script/jquery-1.11.1.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>

</body>

</html>